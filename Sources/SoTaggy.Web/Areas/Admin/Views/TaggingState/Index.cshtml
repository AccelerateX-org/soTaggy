@model SoTaggy.Web.Areas.Admin.Models.TagSearchStateModel

<h2>Tagging Status</h2>

@using (Ajax.BeginForm("Index", "TaggingState", new AjaxOptions
{
    HttpMethod = "POST",
    InsertionMode = InsertionMode.Replace,
    UpdateTargetId = "anzeige",
    OnSuccess = "AssignToGroup",
}, new { @class = "form-inline" }))
{
    <fieldset>
        @Html.Label("Tagging Gruppe auswählen", new { @class = "control-label" })
        <div class="col-xs-12" style="border-bottom: 1px #979797 solid; padding-bottom: 10px; margin-bottom: 5px;">
            <div class="form-group col-md-3 col-sm-6 col-xs-12">
                @Html.DropDownListFor(model => model.TaggingGroupId, null, new { @class = "form-control", @style = "width:100%;" })
                @Html.ValidationMessageFor(model => model.TaggingGroupId)
            </div>

            <div class="col-md-3 col-sm-6 col-xs-12" style="color:#d7e3f2">
                <button type="submit" class="btn btn-success" style="width:100%"><span class="glyphicon glyphicon-tags" aria-hidden="true"></span> Tags Anzeigen</button>
            </div>
        </div>
    </fieldset> 
}

<div id="anzeige"></div>

@section scripts{
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryui")
        <!--Script references. -->
<!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="~/signalr/hubs"></script>
<!--SignalR script to update the chat page and send messages.-->
<script>

    // Reference the auto-generated proxy for the hub.
    var taggingUpdate = $.connection.taggingHub;

    $(function () {
        $.connection.hub.start()

        // Create a function that the hub can call back to display messages.
        taggingUpdate.client.updateImageClient = function (pageUpdate) {
            var id = pageUpdate[0];
            $('#numberTags_' + id).text(pageUpdate[1]);
            $('#numberDifferentTags_' + id).text(pageUpdate[2]);
            if (document.getElementById("ImageId") != null) {
                if ($('#ImageId').text() == id) {
                    $('#TagList').html(pageUpdate[3]);
                }
            }
        };
    });
        function AssignToGroup() {
            taggingUpdate.server.assignToGroupServer($('#GroupId').text());
        }
        function getTags(imageId, groupId) {
            colorImageDiv(imageId);

            $.ajax({
                type: 'POST',
                data: {imageId: imageId, groupId: groupId},
                url: '@Url.Action("GetTags", "TaggingState", new { area = "admin"})',
                success: function(result){
                    $('#TagList').html(result);
                }
            });
            
        }
        function colorImageDiv(imageId) {
            if (document.getElementById("ImageId") != null) {
                var oldImageId = $('#ImageId').text();
                $('#imageDiv_' + oldImageId).css("background-color", "white");
                var newImageId = imageId;
                $('#imageDiv_' + newImageId).css("background-color", "#d7e3f2");
                $('#ImageId').html(imageId);
            }
            else {
                $('#imageDiv_' + imageId).css("background-color", "##d7e3f2");
            }
        }
</script>
}